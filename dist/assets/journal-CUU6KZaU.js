var I=Object.defineProperty;var S=(o,t,e)=>t in o?I(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var n=(o,t,e)=>S(o,typeof t!="symbol"?t+"":t,e);import{g as f,u as E,U as p,b as l,s as y,a as D,f as w,c as A}from"./setInfo-D2ZB1oPv.js";import{G as u,e as N,a as v,o as j,i as k,r as b,T as x,A as M,S as T}from"./lessons-AanttsMv.js";import{S as F}from"./swiper-BTdLKA9U.js";class m{}n(m,"lessons",[]),n(m,"activeLessons",[]);function J(o){return f.get(`${E}/days/getDays.php${o}`)}function O(o){return f.post(`${E}/days/createDay.php`,o,{headers:{"Content-Type":"application/json"}})}function H(o){return f.delete(`${E}/days/deleteDay.php`,o)}function z(o){return f.patch(`${E}/days/updateDay.php`,o,{headers:{"Content-Type":"application/json"}})}class i{constructor(){n(this,"getDate",async(t,e,s=[])=>{try{let a;a=`?user_id=${p.activeUser.id}
                            &group_id=${u.activeGroup.id}
                            &offset=${t}&limit=${e}`,s.length>0&&(s[0].length&&(a=a+`&day=${s[0]}`),s[1].length&&(a=a+`&month=${s[1]}`),s[2].length&&(a=a+`&year=${s[2]}`));const c=await J(a);if(c.status===200)return c.data;await l("Что-то пошло не так..")}catch{await l("Что-то пошло не так..")}});n(this,"checkCorrectDate",async(t,e,s)=>t&&(+t>31||+t<0)?(await l("Некорректно введен день!! Пожалуйста, проверьте поле ввода дня"),!1):e&&(+e<0||+e>12)?(await l("Некорректно введен месяц!! Пожалуйста, проверьте поле ввода месяца"),!1):s&&+s<2e3?(await l("Некорректно введен год!! Пожалуйста, проверьте поле ввода года"),!1):!0)}deleteUnnecessary(t){return t.map(e=>e.replace(/\D/g,""))}correctDate(t){return t=t.map(e=>e.replace(/\s+/g,"")),t=t.map(e=>e.replace(/\D/g,"")),t[0].length===1&&(t[0]=`0${t[0]}`),t[1].length===1&&(t[1]=`0${t[1]}`),t[2].length===1?t[2]=`200${t[2]}`:t[2].length===2?t[2]=`20${t[2]}`:t[2].length===3&&(t[2]=`2${t[2]}`),t}}n(i,"activeDay",{}),n(i,"daysList",[]);function P(o){return f.get(`${E}/classes/getClasses.php${o}`)}function V(o){return f.post(`${E}/classes/createClasses.php`,o,{headers:{"Content-Type":"application/json"}})}function U(o){return f.delete(`${E}/classes/deleteClasses.php`,o)}function G(o){return f.patch(`${E}/classes/updateClasses.php`,o,{headers:{"Content-Type":"application/json"}})}function Z(o){return f.patch(`${E}/classes/updateClassesInfo.php`,o,{headers:{"Content-Type":"application/json"}})}const B=class B{constructor(){n(this,"getClasses",async()=>{try{if(i.activeDay.date_info){let t=`?user_id=${p.activeUser.id}
                                    &group_id=${u.activeGroup.id}
                                    &date_info=${i.activeDay.date_info}`;const e=await P(t);e.status===200?B.activeClasses=e.data:await l("Что-то пошло не так..")}}catch{await l("Что-то пошло не так..")}})}};n(B,"activeClasses",[]);let d=B;function R(o){return f.get(`${E}/students/getStudents.php${o}`)}function W(o){return f.get(`${E}/students/checkStudent.php${o}`)}function Y(o){return f.get(`${E}/students/getStudentPasses.php${o}`)}function q(o){return f.post(`${E}/students/createStudent.php`,o,{headers:{"Content-Type":"application/json"}})}function K(o){return f.delete(`${E}/students/deleteStudent.php`,o)}function Q(o){return f.patch(`${E}/students/updateStudent.php`,o,{headers:{"Content-Type":"application/json"}})}const L=class L{constructor(){n(this,"getStudents",async()=>{try{let t=`?user_id=${p.activeUser.id}&group_id=${u.activeGroup.id}`;const e=await R(t);e.status===200?L.students=e.data:await l("Что-то пошло не так..")}catch{await l("Что-то пошло не так..")}});n(this,"checkAStudent",async(t="",e="",s="",a="")=>{try{let c=`?user_id=${p.activeUser.id}&group_id=${u.activeGroup.id}
                                    &id=${t}&name=${e}&second_name=${s}&surname=${a}`;const h=await W(c);if(h.status===200)return h.data.length===0;await l("Что-то пошло не так..")}catch{await l("Что-то пошло не так..")}})}};n(L,"students",[]),n(L,"activeStudent",{});let r=L;class X{constructor(){n(this,"selectors",{root:"[data-js-journal]",back:"[data-js-journal-back]",group:"[data-js-journal-group]",date:"[data-js-journal-date]",loading:"[data-js-journal-loading]",nullList:"[data-js-journal-null-list]"});n(this,"classes",{isActive:"is-active"});n(this,"loadFunctions",async()=>{this.setGroupName(),await this.getLastDay(),this.updateData(),this.setDate(),$(document).on("updateDate",()=>{this.updateData(),this.setDate()})});n(this,"getLessons",async()=>{try{let t=`?user_id=${p.activeUser.id}&group_id=${u.activeGroup.id}`;const e=await N(t);e.status===200?m.lessons=e.data:await l("Что-то пошло не так..")}catch{await l("Что-то пошло не так..")}});n(this,"getLastDay",async()=>{let t=await new i().getDate(0,1);t.data.length?i.activeDay=t.data[0]:i.activeDay={}});n(this,"updateData",async()=>{d.activeClasses=[],this.nullListElement.removeClass(this.classes.isActive),window.innerWidth<window.innerHeight&&this.loadingElement.addClass(this.classes.isActive),await this.getLessons(),this.getTodayLessons(),await new r().getStudents(),await new d().getClasses(),this.loadingElement.removeClass(this.classes.isActive),d.activeClasses.length||this.nullListElement.addClass(this.classes.isActive),$(document).trigger("journalLoad")});this.journalElement=$(this.selectors.root),this.backBtn=this.journalElement.find(this.selectors.back),this.groupNameElement=this.journalElement.find(this.selectors.group),this.dateNameElement=this.journalElement.find(this.selectors.date),this.loadingElement=this.journalElement.find(this.selectors.loading),this.nullListElement=this.journalElement.find(this.selectors.nullList),this.loadFunctions(),this.bindEvents()}bindEvents(){this.backBtn.on("click",()=>{window.location.href="../../../../groups.html"})}setGroupName(){this.groupNameElement.text(u.activeGroup.name)}setDate(){let t="";i.activeDay.date_info&&(t=`${i.activeDay.day}.${i.activeDay.month}.${i.activeDay.year}`),this.dateNameElement.text(t)}getTodayLessons(){m.activeLessons=[],[i.activeDay.first_lesson,i.activeDay.second_lesson,i.activeDay.third_lesson,i.activeDay.fourth_lesson,i.activeDay.fifth_lesson].forEach(e=>{let s=m.lessons.find(a=>a.id===e);m.activeLessons.push(s==null?void 0:s.name)})}}class tt{constructor(){n(this,"selectors",{verticalJournal:"[data-js-journal-vertical]",verticalJournalList:"[data-js-journal-table-list]",lessons:"[data-js-journal-lesson]",lessonsContainer:"[data-js-journal-lessons-container]",lessonInfo:"[data-js-journal-lesson-info]",lessonInfoClose:"[data-js-journal-lesson-info-close]",lessonInfoText:"[data-js-journal-lesson-info-text]",accordion:"[data-js-journal-accordion]",accordionBtn:"[data-js-journal-accordion-btn]",accordionList:"[data-js-journal-accordion-list]",accordionItem:"[data-js-journal-accordion-item]",accordionMarks:"[data-js-journal-accordion-marks-list]",accordionMarksItem:"[data-js-journal-accordion-marks-item]",horizontalJournal:"[data-js-journal-table]",tableLesson:"[data-js-journal-table-lesson]",tableMain:"[data-js-journal-table-main]",tableLoadingContainer:"[data-js-journal-table-loading-container]",tableLoading:"[data-js-journal-table-loading]",tableNull:"[data-js-journal-table-null-list]",tableFooter:"[data-js-journal-table-footer]",tableMark:"[data-js-journal-table-mark]",tableAbsolute:"[data-js-journal-table-absolute]",tableAbsoluteItem:"[data-js-journal-table-absolute-item]"});n(this,"classes",{isActive:"is-active"});n(this,"loadFunctions",()=>{$(document).on("journalLoad updateStudent removeClasses updateDate",async()=>{await this.reloadTables(),this.bindEvents()})});n(this,"redactClasses",async t=>{try{(await G(t)).status!==200&&(this.returnClasses(),await l("Что-то пошло не так.."))}catch{await l("Что-то пошло не так..")}});n(this,"reloadTables",async()=>{d.activeClasses.length&&this.lessonsContainerElement.addClass(this.classes.isActive),this.tableLoadingElement.removeClass(this.classes.isActive),this.tableLoadingContainerElement.removeClass(this.classes.isActive),this.setNullBlock(),await this.createVerticalJournal(),this.accordionElements=$(this.selectors.accordion),this.accordionBtnElements=this.accordionElements.find(this.selectors.accordionBtn),this.accordionListElements=this.accordionElements.find(this.selectors.accordionList),this.accordionItemElements=this.accordionElements.find(this.selectors.accordionItem),this.accordionMarksElements=this.accordionElements.find(this.selectors.accordionMarks),this.accordionMarksItemElements=this.accordionElements.find(this.selectors.accordionMarksItem),await this.createHorizontalJournal(),this.tableLessonElements=this.horizontalJournalElement.find(this.selectors.tableLesson),this.tableMarkElements=this.horizontalJournalElement.find(this.selectors.tableMark),this.tableAbsoluteElement=this.horizontalJournalElement.find(this.selectors.tableAbsolute),this.tableAbsoluteItemElement=this.horizontalJournalElement.find(this.selectors.tableAbsoluteItem),$(document).trigger("tablesLoad")});n(this,"createVerticalJournal",async()=>new Promise(t=>{let e=d.activeClasses.map((s,a)=>{let c=r.students.find(h=>h.id===s.student_id);return`
                <li class="journal__item accordion" data-js-journal-accordion>
                    <div class="accordion__student">
                      <p class="slice-string h4" data-js-person-open-vertical>${c.second_name} ${c.name}</p>
                      <button class="accordion__btn" data-js-journal-accordion-btn>
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M16.1795 3.26875C15.7889 2.87823 15.1558 2.87823 14.7652 3.26875L8.12078 9.91322C6.94952 11.0845 6.94916 12.9833 8.11996 14.155L14.6903 20.7304C15.0808 21.121 15.714 21.121 16.1045 20.7304C16.495 20.3399 16.495 19.7067 16.1045 19.3162L9.53246 12.7442C9.14194 12.3536 9.14194 11.7205 9.53246 11.33L16.1795 4.68297C16.57 4.29244 16.57 3.65928 16.1795 3.26875Z" fill="#0F0F0F"/>
                        </svg>
                      </button>
                    </div>
                    
                    <ul class="accordion__list" data-js-journal-accordion-list>
                        <li class="accordion__item" data-js-journal-accordion-item>
                            <span class="accordion__item-span">${d.activeClasses[a].first_lesson}</span>
                            <ul class="accordion__item-marks marks" data-js-journal-accordion-marks-list>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>н</li>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>о</li>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>б</li>
                            </ul>
                        </li>
                        <li class="accordion__item" data-js-journal-accordion-item>
                            <span class="accordion__item-span">${d.activeClasses[a].second_lesson}</span>
                            <ul class="accordion__item-marks marks" data-js-journal-accordion-marks-list>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>н</li>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>о</li>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>б</li>
                            </ul>
                        </li>
                        <li class="accordion__item" data-js-journal-accordion-item>
                            <span class="accordion__item-span">${d.activeClasses[a].third_lesson}</span>
                            <ul class="accordion__item-marks marks" data-js-journal-accordion-marks-list>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>н</li>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>о</li>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>б</li>
                            </ul>
                        </li>
                        <li class="accordion__item" data-js-journal-accordion-item>
                            <span class="accordion__item-span">${d.activeClasses[a].fourth_lesson}</span>
                            <ul class="accordion__item-marks marks" data-js-journal-accordion-marks-list>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>н</li>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>о</li>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>б</li>
                            </ul>
                        </li>
                        <li class="accordion__item" data-js-journal-accordion-item>
                            <span class="accordion__item-span">${d.activeClasses[a].fifth_lesson}</span>
                            <ul class="accordion__item-marks marks" data-js-journal-accordion-marks-list>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>н</li>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>о</li>
                                <li class="accordion__item-marks-item" data-js-journal-accordion-marks-item>б</li>
                            </ul>
                        </li>
                    </ul>
                </li>
            `}).join("");this.verticalJournalListElement.html(e),this.verticalJournalListElement.addClass(this.classes.isActive),t()}));n(this,"clickToMark",async(t,e)=>{let s=Math.floor(t/15),a=Math.floor(t/3),c=a;a>4&&(c=a-s*5),await this.setMark(e,a,c,d.activeClasses[s])});n(this,"setMark",async(t,e,s,a)=>{this.oldClasses=a;let c=this.getLesson(s);this.checkMark(a,c,t)?a[c]="":a[c]=t;let _=await new i().getDate(0,1,[i.activeDay.day,i.activeDay.month,i.activeDay.year]),g=await new r().checkAStudent(a.student_id);_.data.length&&!g?($(this.accordionItemElements[e]).find("span").text(a[c]),$(this.tableMarkElements[e]).find("span").text(a[c]),await this.redactClasses(a)):(await l("Студент/день был удален/изменен.. Страница будет перезагружена!!"),location.reload())});n(this,"createHorizontalJournal",async()=>new Promise(t=>{let e=d.activeClasses.map((s,a)=>{let c=r.students.find(h=>h.id===s.student_id);return`
                    <tr class="table__footer-row">
                      <th class="table__footer-student slice-string" data-js-person-open-horizontal>${c.second_name} ${c.name}</th>
                      <th class="table__footer-lesson" data-js-journal-table-mark>
                        <span>${d.activeClasses[a].first_lesson}</span>
                        <ul class="table__footer-list marks" data-js-journal-table-absolute>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>н</li>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>о</li>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>б</li>
                        </ul>
                      </th>
                      <th class="table__footer-lesson" data-js-journal-table-mark>
                        <span>${d.activeClasses[a].second_lesson}</span>
                        <ul class="table__footer-list marks" data-js-journal-table-absolute>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>н</li>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>о</li>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>б</li>
                        </ul>
                      </th>
                      <th class="table__footer-lesson" data-js-journal-table-mark>
                        <span>${d.activeClasses[a].third_lesson}</span>
                        <ul class="table__footer-list marks" data-js-journal-table-absolute>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>н</li>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>о</li>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>б</li>
                        </ul>
                      </th>
                      <th class="table__footer-lesson" data-js-journal-table-mark>
                        <span>${d.activeClasses[a].fourth_lesson}</span>
                        <ul class="table__footer-list marks" data-js-journal-table-absolute>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>н</li>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>о</li>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>б</li>
                        </ul>
                      </th>
                      <th class="table__footer-lesson" data-js-journal-table-mark>
                        <span>${d.activeClasses[a].fifth_lesson}</span>
                        <ul class="table__footer-list marks" data-js-journal-table-absolute>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>н</li>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>о</li>
                          <li class="table__footer-item" data-js-journal-table-absolute-item>б</li>
                        </ul>
                      </th>
                    </tr>
                `}).join("");this.tableFooterElement.html(e),this.tableFooterElement.addClass(this.classes.isActive),t()}));this.verticalJournalElement=$(this.selectors.verticalJournal),this.verticalJournalListElement=$(this.selectors.verticalJournalList),this.horizontalJournalElement=$(this.selectors.horizontalJournal),this.tableMainElement=this.horizontalJournalElement.find(this.selectors.tableMain),this.tableLoadingElement=this.horizontalJournalElement.find(this.selectors.tableLoading),this.tableLoadingContainerElement=this.horizontalJournalElement.find(this.selectors.tableLoadingContainer),this.tableNullElement=this.horizontalJournalElement.find(this.selectors.tableNull),this.tableFooterElement=this.horizontalJournalElement.find(this.selectors.tableFooter),this.lessonsElements=$(this.selectors.lessons),this.lessonsContainerElement=$(this.selectors.lessonsContainer),this.lessonInfoElement=$(this.selectors.lessonInfo),this.lessonInfoCloseBtn=$(this.selectors.lessonInfoClose),this.lessonInfoTextElement=$(this.selectors.lessonInfoText),this.oldClasses={},this.loadFunctions(),this.changeOrientation()}bindEvents(){this.accordionItemElements.off("click"),this.accordionMarksItemElements.off("click"),this.lessonsElements.off("click"),this.tableMarkElements.off("click"),this.tableLessonElements.off("click"),this.tableAbsoluteItemElement.off("click"),this.lessonInfoCloseBtn.off("click"),window.addEventListener("resize",()=>{this.changeOrientation(),v(this.lessonInfoElement)}),this.accordionBtnElements.each((t,e)=>{$(e).on("click",s=>{this.openCloseAccordion(t),s.stopPropagation()})}),this.accordionItemElements.each((t,e)=>{$(e).on("click",s=>{this.openMarksBlock(t),s.stopPropagation()})}),this.accordionMarksItemElements.each((t,e)=>{$(e).on("click",()=>{this.clickToMark(t,$(e).text())})}),this.lessonsElements.each((t,e)=>{$(e).on("click",()=>{m.activeLessons[t]&&this.openLessonInfo(t,e)})}),this.tableMarkElements.each((t,e)=>{$(e).on("click",()=>{this.openMarksBlockHorizontal(t)})}),this.tableLessonElements.each((t,e)=>{$(e).on("click",()=>{m.activeLessons[t]&&this.openLessonInfo(t,e)})}),this.tableAbsoluteItemElement.each((t,e)=>{$(e).on("click",()=>{this.clickToMark(t,$(e).text())})}),this.lessonInfoCloseBtn.on("click",()=>{v(this.lessonInfoElement)})}openLessonInfo(t,e){this.lessonInfoTextElement.text(m.activeLessons[t]),j(this.lessonInfoElement,e)}openCloseAccordion(t){$(this.accordionListElements[t]).toggleClass(this.classes.isActive),$(this.accordionBtnElements[t]).toggleClass(this.classes.isActive),$(this.accordionBtnElements[t]).hasClass(this.classes.isActive)||this.closeAllMarksBlock()}openMarksBlock(t){let e=this.accordionElements.find(`${this.selectors.accordionMarks}.${this.classes.isActive}`);this.closeAllMarksBlock(),e[0]!==this.accordionMarksElements[t]&&$(this.accordionMarksElements[t]).addClass(this.classes.isActive)}closeAllMarksBlock(){this.accordionMarksElements.each((t,e)=>{$(e).removeClass(this.classes.isActive)})}returnClasses(){d.activeClasses=d.activeClasses.map(t=>t.user_id===this.oldClasses.user_id&&t.group_id===this.oldClasses.group_id&&t.student_id===this.oldClasses.student_id&&t.date_info===this.oldClasses.date_info?this.oldClasses:t)}getLesson(t){return["first_lesson","second_lesson","third_lesson","fourth_lesson","fifth_lesson"][t]}checkMark(t,e,s){return s===t[e]}changeOrientation(){window.innerWidth<window.innerHeight?(this.verticalJournalElement.addClass(this.classes.isActive),this.horizontalJournalElement.removeClass(this.classes.isActive)):(this.verticalJournalElement.removeClass(this.classes.isActive),this.horizontalJournalElement.addClass(this.classes.isActive))}openMarksBlockHorizontal(t){let e=this.tableFooterElement.find(`${this.selectors.tableAbsolute}.${this.classes.isActive}`);this.closeAllMarksBlockHorizontal(),e[0]!==this.tableAbsoluteElement[t]&&$(this.tableAbsoluteElement[t]).addClass(this.classes.isActive)}closeAllMarksBlockHorizontal(){this.tableAbsoluteElement.each((t,e)=>{$(e).removeClass(this.classes.isActive)})}setNullBlock(){d.activeClasses.length?(this.tableNullElement.removeClass(this.classes.isActive),this.tableMainElement.removeClass(this.classes.isActive)):this.tableNullElement.addClass(this.classes.isActive)}}class et{constructor(){n(this,"selectors",{root:"[data-js-students]",close:"[data-js-students-close]",list:"[data-js-students-list]",item:"[data-js-students-item]",btnBar:"[data-js-students-btn-bar]",open:"[data-js-students-open]",delete:"[data-js-students-delete-btn]",create:"[data-js-students-create]",createName:"[data-js-students-create-name]",createNameCounter:"[data-js-students-create-name-counter]",createSecondName:"[data-js-students-create-second-name]",createSecondNameCounter:"[data-js-students-create-second-name-counter]",createSurname:"[data-js-students-create-surname]",createSurnameCounter:"[data-js-students-create-surname-counter]",createBtn:"[data-js-students-create-btn]",createLoading:"[data-js-students-create-loading]",createClose:"[data-js-students-create-close]",createOpen:"[data-js-students-create-btn-open]",redact:"[data-js-students-redact]",redactName:"[data-js-students-redact-name]",redactNameCounter:"[data-js-students-redact-name-counter]",redactSecondName:"[data-js-students-redact-second-name]",redactSecondNameCounter:"[data-js-students-redact-second-name-counter]",redactSurname:"[data-js-students-redact-surname]",redactSurnameCounter:"[data-js-students-redact-surname-counter]",redactBtn:"[data-js-students-redact-btn]",redactLoading:"[data-js-students-redact-loading]",redactClose:"[data-js-students-redact-close]",redactOpen:"[data-js-students-redact-open]"});n(this,"classes",{isActive:"is-active"});n(this,"loadFunctions",()=>{$(document).on("journalLoad",this.getListElements.bind(this)),this.clearCreateBlock()});n(this,"createStudent",async()=>{try{y(this.createBtn,this.createLoadingElement);let[t,e,s]=this.correctData(this.createNameElement.val(),this.createSecondNameElement.val(),this.createSurnameElement.val()),a=this.checkDoubleFIO(t,e,s),c=await this.students.checkAStudent("",t,e,s);if(a&&c){let h={user_id:p.activeUser.id,group_id:u.activeGroup.id,name:t,second_name:e,surname:s};(await q(h)).status===200?(await this.students.getStudents(),this.getListElements(),this.closeCreateBlock(),D("Студент добавлен!!")):await l("Что-то пошло не так..")}else await l("Такой студент уже существует!!")}catch{await l("Что-то пошло не так..")}finally{y(this.createBtn,this.createLoadingElement)}});n(this,"deleteStudent",async t=>{try{let e={params:{user_id:p.activeUser.id,group_id:u.activeGroup.id,id:t}};(await K(e)).status===200?(r.students=r.students.filter(c=>c.id!==t),this.getListElements(),d.activeClasses.some(c=>c.student_id===t)&&(d.activeClasses=d.activeClasses.filter(c=>c.student_id!==t),$(document).trigger("updateStudent")),D("Студент удален!!")):await l("Что-то пошло не так..")}catch{await l("Что-то пошло не так..")}});n(this,"redactStudent",async()=>{try{y(this.redactBtn,this.redactLoadingElement);let[t,e,s]=this.correctData(this.redactNameElement.val(),this.redactSecondNameElement.val(),this.redactSurnameElement.val()),a=this.checkDoubleFIO(t,e,s),c=await this.students.checkAStudent("",t,e,s);if(a&&c){let h={user_id:p.activeUser.id,group_id:u.activeGroup.id,id:r.activeStudent.id,name:t,second_name:e,surname:s};(await Q(h)).status===200?(r.students=r.students.map(C=>C.id===r.activeStudent.id?{...C,name:t,second_name:e,surname:s}:C),this.getListElements(),v(this.redactElement),d.activeClasses.some(C=>C.student_id===r.activeStudent.id)&&$(document).trigger("updateStudent"),D("Студент редактирован!!")):await l("Что-то пошло не так..")}else await l("Такой студент уже существует!!")}catch{await l("Что-то пошло не так..")}finally{y(this.redactBtn,this.redactLoadingElement)}});n(this,"closeCreateBlock",async()=>{await v(this.createElement),this.clearCreateBlock()});n(this,"clickToCreate",async()=>{await w("Вы действительно хотите добавить студента?")&&this.createStudent()});n(this,"correctData",(...t)=>(t=t.map(e=>e.replace(/\s+/g,"")),t=t.map(e=>e.replace(/\d+/g,"")),t=t.map(e=>e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase()),t));n(this,"clickToDelete",async t=>{await w("Вы действительно хотите удалить студента?")&&this.deleteStudent(t)});n(this,"clickToRedact",async()=>{await w("Вы действительно хотите редактировать студента?")&&this.redactStudent()});this.students=new r,this.studentsElement=$(this.selectors.root),this.closeBtn=this.studentsElement.find(this.selectors.close),this.studentsListElement=this.studentsElement.find(this.selectors.list),this.openBtn=$(this.selectors.open),this.createElement=this.studentsElement.find(this.selectors.create),this.createNameElement=this.studentsElement.find(this.selectors.createName),this.createNameCounterElement=this.studentsElement.find(this.selectors.createNameCounter),this.createSecondNameElement=this.studentsElement.find(this.selectors.createSecondName),this.createSecondNameCounterElement=this.studentsElement.find(this.selectors.createSecondNameCounter),this.createSurnameElement=this.studentsElement.find(this.selectors.createSurname),this.createSurnameCounterElement=this.studentsElement.find(this.selectors.createSurnameCounter),this.createBtn=this.studentsElement.find(this.selectors.createBtn),this.createLoadingElement=this.studentsElement.find(this.selectors.createLoading),this.createCloseBtn=this.studentsElement.find(this.selectors.createClose),this.createOpenBtn=this.studentsElement.find(this.selectors.createOpen),this.redactElement=this.studentsElement.find(this.selectors.redact),this.redactNameElement=this.studentsElement.find(this.selectors.redactName),this.redactNameCounterElement=this.studentsElement.find(this.selectors.redactNameCounter),this.redactSecondNameElement=this.studentsElement.find(this.selectors.redactSecondName),this.redactSecondNameCounterElement=this.studentsElement.find(this.selectors.redactSecondNameCounter),this.redactSurnameElement=this.studentsElement.find(this.selectors.redactSurname),this.redactSurnameCounterElement=this.studentsElement.find(this.selectors.redactSurnameCounter),this.redactBtn=this.studentsElement.find(this.selectors.redactBtn),this.redactLoadingElement=this.studentsElement.find(this.selectors.redactLoading),this.redactCloseBtn=this.studentsElement.find(this.selectors.redactClose),this.loadFunctions(),this.bindEvents()}bindEvents(){this.closeBtn.on("click",()=>{v(this.studentsElement),this.closeAllBtnBars()}),this.openBtn.on("click",()=>{j(this.studentsElement,this.openBtn[0])}),this.createOpenBtn.on("click",()=>{j(this.createElement,this.createOpenBtn[0])}),this.createCloseBtn.on("click",this.closeCreateBlock.bind(this)),this.createNameElement.on("input",t=>{k(t,this.createNameCounterElement),b(t,["","",""])}),this.createSecondNameElement.on("input",t=>{k(t,this.createSecondNameCounterElement),b(t,["","",""])}),this.createSurnameElement.on("input",t=>{k(t,this.createSurnameCounterElement),b(t,["","",""])}),this.createBtn.on("click",this.clickToCreate.bind(this)),this.redactCloseBtn.on("click",()=>{v(this.redactElement)}),this.redactNameElement.on("input",t=>{k(t,this.redactNameCounterElement),b(t,[r.activeStudent.name,r.activeStudent.second_name,r.activeStudent.surname])}),this.redactSecondNameElement.on("input",t=>{k(t,this.redactSecondNameCounterElement),b(t,[r.activeStudent.name,r.activeStudent.second_name,r.activeStudent.surname])}),this.redactSurnameElement.on("input",t=>{k(t,this.redactSurnameCounterElement),b(t,[r.activeStudent.name,r.activeStudent.second_name,r.activeStudent.surname])}),this.redactBtn.on("click",this.clickToRedact.bind(this))}getListElements(){this.createStudentsList(),this.studentsItemElements=this.studentsElement.find(this.selectors.item),this.btnBarElements=this.studentsElement.find(this.selectors.btnBar),this.deleteBtns=this.studentsElement.find(this.selectors.delete),this.redactOpenBtns=this.studentsElement.find(this.selectors.redactOpen),this.studentsItemElements.each((t,e)=>{$(e).on("click",()=>{this.openBtnBar(t)})}),this.deleteBtns.each((t,e)=>{$(e).on("click",s=>{this.clickToDelete(r.students[t].id),s.stopPropagation()})}),this.redactOpenBtns.each((t,e)=>{$(e).on("click",s=>{this.openRedactBlock(t,e),s.stopPropagation()})})}createStudentsList(){let t=r.students.map(e=>`
                <li class="journal-students__item list__item" data-js-students-item>
                <p class="slice-string h4">${e.second_name} ${e.name}</p>
                <div class="journal-students__btn-bar list__btn-bar" data-js-students-btn-bar>
                  <button class="list-btn"
                          type="button"
                          aria-label="Редактировать студента"
                          title="Редактировать студента"
                          data-js-students-redact-open
                  >
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd" d="M21.1213 2.70705C19.9497 1.53548 18.0503 1.53547 16.8787 2.70705L15.1989 4.38685L7.29289 12.2928C7.16473 12.421 7.07382 12.5816 7.02986 12.7574L6.02986 16.7574C5.94466 17.0982 6.04451 17.4587 6.29289 17.707C6.54127 17.9554 6.90176 18.0553 7.24254 17.9701L11.2425 16.9701C11.4184 16.9261 11.5789 16.8352 11.7071 16.707L19.5556 8.85857L21.2929 7.12126C22.4645 5.94969 22.4645 4.05019 21.2929 2.87862L21.1213 2.70705ZM18.2929 4.12126C18.6834 3.73074 19.3166 3.73074 19.7071 4.12126L19.8787 4.29283C20.2692 4.68336 20.2692 5.31653 19.8787 5.70705L18.8622 6.72357L17.3068 5.10738L18.2929 4.12126ZM15.8923 6.52185L17.4477 8.13804L10.4888 15.097L8.37437 15.6256L8.90296 13.5112L15.8923 6.52185ZM4 7.99994C4 7.44766 4.44772 6.99994 5 6.99994H10C10.5523 6.99994 11 6.55223 11 5.99994C11 5.44766 10.5523 4.99994 10 4.99994H5C3.34315 4.99994 2 6.34309 2 7.99994V18.9999C2 20.6568 3.34315 21.9999 5 21.9999H16C17.6569 21.9999 19 20.6568 19 18.9999V13.9999C19 13.4477 18.5523 12.9999 18 12.9999C17.4477 12.9999 17 13.4477 17 13.9999V18.9999C17 19.5522 16.5523 19.9999 16 19.9999H5C4.44772 19.9999 4 19.5522 4 18.9999V7.99994Z" fill="#000000"/>
                    </svg>
                  </button>
                  <button class="list-btn"
                          type="button"
                          aria-label="Удалить студента"
                          title="Удалить студента"
                          data-js-students-delete-btn
                  >
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M4 7H20" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M6 7V18C6 19.6569 7.34315 21 9 21H15C16.6569 21 18 19.6569 18 18V7" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5V7H9V5Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>
              </li>
            `).join("");this.studentsListElement.html(t)}openBtnBar(t){$(this.btnBarElements[t]).toggleClass(this.classes.isActive)}clearCreateBlock(){this.createNameElement.val(""),this.createSecondNameElement.val(""),this.createSurnameElement.val(""),this.createNameCounterElement.text(0),this.createSecondNameCounterElement.text(0),this.createSurnameCounterElement.text(0),this.createBtn.attr("disabled",!0)}checkDoubleFIO(t,e,s){return r.students.length?!r.students.some(a=>a.name===t&&a.second_name===e&&a.surname===s):!0}openRedactBlock(t,e){r.activeStudent=r.students[t],this.redactNameElement.val(r.activeStudent.name),this.redactSecondNameElement.val(r.activeStudent.second_name),this.redactSurnameElement.val(r.activeStudent.surname),this.redactNameCounterElement.text(r.activeStudent.name.length),this.redactSecondNameCounterElement.text(r.activeStudent.second_name.length),this.redactSurnameCounterElement.text(r.activeStudent.surname.length),j(this.redactElement,e)}closeAllBtnBars(){var t;(t=this.btnBarElements)==null||t.each((e,s)=>{$(s).removeClass(this.classes.isActive)})}}class st{constructor(){n(this,"selectors",{person:"[data-js-person]",personOpenVertical:"[data-js-person-open-vertical]",personOpenHorizontal:"[data-js-person-open-horizontal]",personClose:"[data-js-person-close]",personLoading:"[data-js-person-loading]",personName:"[data-js-person-name]",personDateOpen:"[data-js-person-date-open]",personDate:"[data-js-person-date]",personDateBtn:"[data-js-person-date-btn]",personInfo:"[data-js-person-info]"});n(this,"classes",{isActive:"is-active"});n(this,"loadFunctions",()=>{$(document).on("tablesLoad",()=>{this.personOpenVerticalBtns=$(this.selectors.personOpenVertical),this.personOpenHorizontalBtns=$(this.selectors.personOpenHorizontal),this.personOpenVerticalBtns.each((t,e)=>{i.activeDay.date_info&&$(e).on("click",()=>{this.setInfoToPersonBlock(d.activeClasses[t].student_id),j(this.personElement,e)})}),this.personOpenHorizontalBtns.each((t,e)=>{i.activeDay.date_info&&$(e).on("click",()=>{this.setInfoToPersonBlock(d.activeClasses[t].student_id),j(this.personElement,e)})})}),this.setDateBlockPosition(),$(window).on("resize",this.setDateBlockPosition.bind(this))});n(this,"getPasses",async t=>{try{this.personLoadingElement.addClass(this.classes.isActive);let e=`?user_id=${p.activeUser.id}
                                  &group_id=${u.activeGroup.id}
                                  &student_id=${r.activeStudent.id}
                                  &from=${t}&to=${i.activeDay.date_info}`;const s=await Y(e);s.status===200?(this.personInfoArr=s.data,this.setNumbersToPersonBlock()):await setAlert("Что-то пошло не так..")}catch{await setAlert("Что-то пошло не так..")}finally{this.personLoadingElement.removeClass(this.classes.isActive)}});this.students=new r,this.personElement=$(this.selectors.person),this.personCloseBnt=this.personElement.find(this.selectors.personClose),this.personLoadingElement=this.personElement.find(this.selectors.personLoading),this.personNameElement=this.personElement.find(this.selectors.personName),this.personDateOpen=this.personElement.find(this.selectors.personDateOpen),this.personDateElement=this.personElement.find(this.selectors.personDate),this.personDateBtns=this.personElement.find(this.selectors.personDateBtn),this.personInfoElements=this.personElement.find(this.selectors.personInfo),this.personListItems=["За неделю","За месяц","За семестр","За год"],this.personInfoArr={н:0,о:0,б:0},this.loadFunctions(),this.bindEvents()}bindEvents(){this.personCloseBnt.on("click",()=>{v(this.personElement)}),this.personDateOpen.on("click",()=>{this.personDateElement.toggleClass(this.classes.isActive)}),this.personDateBtns.each((t,e)=>{$(e).on("click",()=>{this.personDateElement.removeClass(this.classes.isActive),this.getDateForServer(this.personListItems[t])})})}setInfoToPersonBlock(t){r.activeStudent=r.students.find(e=>e.id===t),this.personNameElement.text(`${r.activeStudent.second_name} ${r.activeStudent.name}`),this.getDateForServer(this.personListItems[0])}setNumbersToPersonBlock(){$(this.personInfoElements[0]).text(this.personInfoArr.н),$(this.personInfoElements[1]).text(this.personInfoArr.о),$(this.personInfoElements[2]).text(this.personInfoArr.б)}getActiveDateInfo(){let t=parseInt(i.activeDay.day,10),e=parseInt(i.activeDay.month,10)-1,s=parseInt(i.activeDay.year,10);return{day:t,month:e,year:s}}getDateForServer(t){let e="";switch(t){case this.personListItems[0]:e=this.getDateForWeek();break;case this.personListItems[1]:e=this.getDateForMonth();break;case this.personListItems[2]:e=this.getDateForSemester();break;case this.personListItems[3]:e=this.getDateForYear();break}this.getPasses(e)}getDateForWeek(){let{day:t,month:e,year:s}=this.getActiveDateInfo();const a=new Date(s,e,t);let c=a.setDate(a.getDate()-7);const h=new Date(c);return`${String(h.getDate()).padStart(2,"0")}
          ${String(h.getMonth()+1).padStart(2,"0")}
          ${h.getFullYear()}`}getDateForMonth(){let{day:t,month:e,year:s}=this.getActiveDateInfo();const a=new Date(s,e,t),c=a.setMonth(a.getMonth()-1),h=new Date(c);return`${String(h.getDate()).padStart(2,"0")}
          ${String(h.getMonth()+1).padStart(2,"0")}
          ${h.getFullYear()}`}getDateForSemester(){let{month:t,year:e}=this.getActiveDateInfo();if(t<8&&t>=0)return`0101${e}`;if(t>=8&&t<=11)return`0109${e}`}getDateForYear(){let{month:t,year:e}=this.getActiveDateInfo();if(t<8&&t>=0)return`0109${e-1}`;if(t>=8&&t<=11)return`0109${e}`}setDateBlockPosition(){window.innerWidth<window.innerHeight?this.personDateElement.css({transformOrigin:"center bottom",bottom:"-80%",right:"-30%"}):this.personDateElement.css({transformOrigin:"right center",right:"-5%",bottom:"-300%"})}}class at{constructor(){n(this,"selectors",{root:"[data-js-date]",open:"[data-js-date-open]",close:"[data-js-date-close]",searchInput:"[data-js-date-search-input]",searchBtn:"[data-js-date-search]",noData:"[data-js-date-no-data]",loading:"[data-js-date-loading]",nullList:"[data-js-date-null-list]",list:"[data-js-date-list]",item:"[data-js-date-item]",itemName:"[data-js-date-item-name]",itemInfoBtn:"[data-js-date-item-info]",itemBtnBar:"[data-js-date-item-btn-bar]",itemDelete:"[data-js-date-item-delete]"});n(this,"classes",{isActive:"is-active"});n(this,"loadFunctions",()=>{this.clearSearchInputs(),$(document).on("createDaysList deleteDay",()=>{this.itemElements=this.dateElement.find(this.selectors.item),this.itemInfoBtns=this.dateElement.find(this.selectors.itemInfoBtn),this.itemBtnBarElements=this.dateElement.find(this.selectors.itemBtnBar),this.itemDeleteBtn=this.dateElement.find(this.selectors.itemDelete),this.itemElements.off("click"),this.itemInfoBtns.off("click"),this.itemDeleteBtn.off("click"),this.itemElements.each((t,e)=>{$(e).on("click",()=>{this.clickToDay(i.daysList[t],t)})}),this.itemInfoBtns.each((t,e)=>{$(e).on("click",s=>{$(this.itemBtnBarElements[t]).addClass(this.classes.isActive),s.stopPropagation()})}),this.itemDeleteBtn.each((t,e)=>{$(e).on("click",s=>{this.clickToDelete(i.daysList[t].date_info),s.stopPropagation()})})}),$(document).on("createDay",()=>{this.createDaysList(i.daysList),this.clickToDay(i.daysList[0],0)}),$(document).on("redactDay",(t,e)=>{this.createDaysList(i.daysList),e>0&&this.clickToDay(i.daysList[e],e)})});n(this,"getDays",async(t=[])=>{try{this.loadingElement.addClass(this.classes.isActive);let e=await this.days.getDate(0,20,t);e.data.length?(this.nullListElement.removeClass(this.classes.isActive),this.noDataElement.removeClass(this.classes.isActive),this.checkNumberDaysList(e),this.createDaysList(e.data)):(this.nullListElement.addClass(this.classes.isActive),this.noDataElement.addClass(this.classes.isActive))}catch{await l("Что-то пошло не так..")}finally{this.loadingElement.removeClass(this.classes.isActive)}});n(this,"deleteDay",async t=>{try{let e={params:{user_id:p.activeUser.id,group_id:u.activeGroup.id,date_info:t}};(await H(e)).status===200?await this.deleteClasses(t):await l("Что-то пошло не так..")}catch{await l("Что-то пошло не так..")}finally{}});n(this,"deleteClasses",async t=>{try{let e={params:{user_id:p.activeUser.id,group_id:u.activeGroup.id,date_info:t}};(await U(e)).status===200?(await this.setNewDay(t),$(document).trigger("deleteDay"),D("День удален!!")):await l("Что-то пошло не так..")}catch{await l("Что-то пошло не так..")}});n(this,"clickToFindDate",async()=>{let[t,e,s]=this.days.deleteUnnecessary([$(this.searchInputElements[0]).val(),$(this.searchInputElements[1]).val(),$(this.searchInputElements[2]).val()]),a=this.days.correctDate([t,e,s]);t=a[0],e=a[1],s=a[2],await this.days.checkCorrectDate(t,e,s)&&(this.loadingElement.addClass(this.classes.isActive),this.noDataElement.addClass(this.classes.isActive),this.listElement.empty(),this.getDays([t,e,s]))});n(this,"clickToDay",async(t,e)=>{var a;(await this.days.getDate(0,1,[t.day,t.month,t.year])).data.length?((a=i.activeDay)==null?void 0:a.date_info)!==t.date_info&&(i.activeDay=t,this.setDayActiveClass(e),$(document).trigger("updateDate")):(await l("День был изменен/удален.. Страница будет перезагружена!!"),location.reload())});n(this,"setNewDay",async t=>{let e;i.daysList=i.daysList.filter((s,a)=>s.date_info===t?(e=a,!1):!0),$(this.itemElements[e]).remove(),i.daysList.length===0?(d.activeClasses=[],$(document).trigger("removeClasses")):i.activeDay.date_info===t&&(i.activeDay={},this.clickToDay(i.daysList[0],0))});n(this,"clickToDelete",async t=>{await w("Вы действительно хотите удалить выбранный день?")&&this.deleteDay(t)});this.days=new i,this.dateElement=$(this.selectors.root),this.openBtn=$(this.selectors.open),this.closeBtn=this.dateElement.find(this.selectors.close),this.searchInputElements=this.dateElement.find(this.selectors.searchInput),this.searchBtn=this.dateElement.find(this.selectors.searchBtn),this.noDataElement=this.dateElement.find(this.selectors.noData),this.loadingElement=this.dateElement.find(this.selectors.loading),this.nullListElement=this.dateElement.find(this.selectors.nullList),this.listElement=this.dateElement.find(this.selectors.list),this.remainingNumber=0,this.openBlockCounter=!1,this.loadFunctions(),this.bindEvents()}bindEvents(){this.openBtn.on("click",()=>{j(this.dateElement,this.openBtn[0]),this.openBlockCounter||(this.getDays(),this.openBlockCounter=!0)}),this.closeBtn.on("click",()=>{v(this.dateElement),this.closeAllBtnBars()}),this.searchBtn.on("click",t=>{this.clickToFindDate(),t.preventDefault()})}clearSearchInputs(){this.searchInputElements.each((t,e)=>$(e).val(""))}checkNumberDaysList(t){t.data.length?(i.daysList=t.data,this.remainingNumber=t.remaining):(i.daysList=[],this.remainingNumber=0)}setMonthName(t){return["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"][+t-1]}createDaysList(t){let e=t.map(s=>{let a="date__item list__item";return i.activeDay.date_info===s.date_info&&(a="date__item list__item is-active"),`
                <li class="${a}" data-js-date-item>
                  <p class="h5" data-js-date-item-name>${s.day} ${this.setMonthName(s.month)} ${s.year}</p>
    
                  <button class="date__list-btn" type="button" data-js-date-item-info>
                    <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:none;}</style></defs><title/><g data-name="Layer 2" id="Layer_2"><path d="M16,12a2,2,0,1,1,2-2A2,2,0,0,1,16,12Zm0-2Z"/><path d="M16,29A13,13,0,1,1,29,16,13,13,0,0,1,16,29ZM16,5A11,11,0,1,0,27,16,11,11,0,0,0,16,5Z"/><path d="M16,24a2,2,0,0,1-2-2V16a2,2,0,0,1,4,0v6A2,2,0,0,1,16,24Zm0-8v0Z"/></g><g id="frame"><rect class="cls-1" height="32" width="32"/></g></svg>
                  </button>
                  
                  <div class="date__list-btn-bar" data-js-date-item-btn-bar>
                    <button class="date__list-btn" type="button" data-js-date-redact-open>
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M21.1213 2.70705C19.9497 1.53548 18.0503 1.53547 16.8787 2.70705L15.1989 4.38685L7.29289 12.2928C7.16473 12.421 7.07382 12.5816 7.02986 12.7574L6.02986 16.7574C5.94466 17.0982 6.04451 17.4587 6.29289 17.707C6.54127 17.9554 6.90176 18.0553 7.24254 17.9701L11.2425 16.9701C11.4184 16.9261 11.5789 16.8352 11.7071 16.707L19.5556 8.85857L21.2929 7.12126C22.4645 5.94969 22.4645 4.05019 21.2929 2.87862L21.1213 2.70705ZM18.2929 4.12126C18.6834 3.73074 19.3166 3.73074 19.7071 4.12126L19.8787 4.29283C20.2692 4.68336 20.2692 5.31653 19.8787 5.70705L18.8622 6.72357L17.3068 5.10738L18.2929 4.12126ZM15.8923 6.52185L17.4477 8.13804L10.4888 15.097L8.37437 15.6256L8.90296 13.5112L15.8923 6.52185ZM4 7.99994C4 7.44766 4.44772 6.99994 5 6.99994H10C10.5523 6.99994 11 6.55223 11 5.99994C11 5.44766 10.5523 4.99994 10 4.99994H5C3.34315 4.99994 2 6.34309 2 7.99994V18.9999C2 20.6568 3.34315 21.9999 5 21.9999H16C17.6569 21.9999 19 20.6568 19 18.9999V13.9999C19 13.4477 18.5523 12.9999 18 12.9999C17.4477 12.9999 17 13.4477 17 13.9999V18.9999C17 19.5522 16.5523 19.9999 16 19.9999H5C4.44772 19.9999 4 19.5522 4 18.9999V7.99994Z" fill="#000000"/>
                        </svg>
                    </button>
                    <button class="date__list-btn" type="button" data-js-date-item-delete>
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 7H20" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M6 7V18C6 19.6569 7.34315 21 9 21H15C16.6569 21 18 19.6569 18 18V7" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5V7H9V5Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                  </div>
                </li>
            `}).join("");this.listElement.html(e),$(document).trigger("createDaysList")}setDayActiveClass(t){this.itemElements.each((e,s)=>$(s).removeClass(this.classes.isActive)),$(this.itemElements[t]).addClass(this.classes.isActive)}closeAllBtnBars(){var t;(t=this.itemBtnBarElements)==null||t.each((e,s)=>$(s).removeClass(this.classes.isActive))}}class nt{constructor(){n(this,"selectors",{root:"[data-js-date-create]",swiper:"[data-js-date-create-swiper]",open:"[data-js-date-create-open]",close:"[data-js-date-create-close]",counter:"[data-js-date-create-counter]",name:"[data-js-date-create-name]",dayInput:"[data-js-date-create-day]",dayCounter:"[data-js-date-create-day-counter]",monthInput:"[data-js-date-create-month]",monthCounter:"[data-js-date-create-month-counter]",yearInput:"[data-js-date-create-year]",yearCounter:"[data-js-date-create-year-counter]",todayBtn:"[data-js-date-create-today]",prevBtn:"[data-js-date-create-prev]",nextBtn:"[data-js-date-create-next]",nextText:"[data-js-date-create-next-text]",loading:"[data-js-date-create-loading]",select:"[data-js-date-create-select]"});n(this,"classes",{isActive:"is-active"});n(this,"loadFunctions",()=>{this.clearInfo()});n(this,"createDay",async t=>{try{y(this.nextBtn,this.loadingElement);let e={user_id:p.activeUser.id,group_id:u.activeGroup.id,date_info:`${this.day}${this.month}${this.year}`,day:this.day,month:this.month,year:this.year,first_lesson:t[0],second_lesson:t[1],third_lesson:t[2],fourth_lesson:t[3],fifth_lesson:t[4]};(await O(e)).status===200?await this.createClasses(e):await l("Что-то пошло не так..")}catch{await l("Что-то пошло не так..")}});n(this,"createClasses",async t=>{try{let e=[];r.students.forEach(a=>{e.push({user_id:p.activeUser.id,group_id:u.activeGroup.id,student_id:a.id,date_info:`${t.day}${t.month}${t.year}`,first_lesson:"",second_lesson:"",third_lesson:"",fourth_lesson:"",fifth_lesson:""})}),console.log(e,r.students),(await V(e)).status===200?(i.daysList.unshift(t),$(document).trigger("createDay"),D("День добавлен!!"),v(this.createElement),this.clearInfo()):await l("Что-то пошло не так..")}catch{await l("Что-то пошло не так..")}finally{y(this.nextBtn,this.loadingElement)}});n(this,"clickToNext",async()=>{this.swiperElement.activeIndex===0?await this.clickToNextFirst():(this.nextTextElement.text("Готово"),await w("Вы действительно хотите добавить дату?")&&this.clickToReady()),this.counterElement.text(this.swiperElement.activeIndex+1)});n(this,"clickToNextFirst",async()=>{var t;try{if(y(this.nextBtn,this.loadingElement),this.checkInputLength())if(this.correctDate()){let a;this.dateCreateCounter||(a=await this.days.getDate(0,1,[this.day,this.month,this.year])),!((t=a==null?void 0:a.data)!=null&&t.length)||this.dateCreateCounter?(this.lessonsCreateCounter||(this.createSelects(),this.lessonsCreateCounter=!0),this.dateCreateCounter=!0,this.nameElement.text("Выбор предметов"),this.nextTextElement.text("Готово"),this.swiperElement.slideTo(1),this.prevBtn.attr("disabled",!1)):await l("Такая дата уже существует!!")}else await l("Введенная дата некорректна!!");else await l("Заполните все поля ввода!!")}catch(e){await l(e)}finally{y(this.nextBtn,this.loadingElement)}});this.days=new i,this.createElement=$(this.selectors.root),this.openBtn=$(this.selectors.open),this.closeBtn=this.createElement.find(this.selectors.close),this.counterElement=this.createElement.find(this.selectors.counter),this.nameElement=this.createElement.find(this.selectors.name),this.dayInputElement=this.createElement.find(this.selectors.dayInput),this.dayCounterElement=this.createElement.find(this.selectors.dayCounter),this.monthInputElement=this.createElement.find(this.selectors.monthInput),this.monthCounterElement=this.createElement.find(this.selectors.monthCounter),this.yearInputElement=this.createElement.find(this.selectors.yearInput),this.yearCounterElement=this.createElement.find(this.selectors.yearCounter),this.todayBtn=this.createElement.find(this.selectors.todayBtn),this.prevBtn=this.createElement.find(this.selectors.prevBtn),this.nextBtn=this.createElement.find(this.selectors.nextBtn),this.nextTextElement=this.createElement.find(this.selectors.nextText),this.loadingElement=this.createElement.find(this.selectors.loading),this.selectElements=this.createElement.find(this.selectors.select),this.swiperElement=new F(this.selectors.swiper,{effect:"flip",allowTouchMove:!1}),this.day="",this.month="",this.year="",this.lessonsCreateCounter=!1,this.dateCreateCounter=!1,this.loadFunctions(),this.bindEvents()}bindEvents(){this.openBtn.on("click",async()=>{r.students.length?j(this.createElement,this.openBtn[0]):await l("Добавьте сначала хотя бы одного студента!!")}),this.closeBtn.on("click",async()=>{await v(this.createElement),this.clearInfo(),this.lessonsCreateCounter=!1,this.dateCreateCounter=!1}),this.dayInputElement.on("input",t=>{k(t,this.dayCounterElement),this.dateCreateCounter=!1}),this.monthInputElement.on("input",t=>{k(t,this.monthCounterElement),this.dateCreateCounter=!1}),this.yearInputElement.on("input",t=>{k(t,this.yearCounterElement),this.dateCreateCounter=!1}),this.nextBtn.on("click",()=>{this.clickToNext()}),this.prevBtn.on("click",()=>{this.clickToPrevSlide()}),this.todayBtn.on("click",this.clickToToday.bind(this))}clearInfo(){this.counterElement.text(1),this.dayInputElement.val(""),this.monthInputElement.val(""),this.yearInputElement.val(""),this.dayCounterElement.text(0),this.monthCounterElement.text(0),this.yearCounterElement.text(0),this.swiperElement.slideTo(0),this.nameElement.text("Формирование даты"),this.nextTextElement.text("Далее")}checkInputLength(){return this.dayInputElement.val().length>0&&this.monthInputElement.val().length>0&&this.yearInputElement.val().length>0}correctDate(){[this.day,this.month,this.year]=this.days.deleteUnnecessary([this.dayInputElement.val(),this.monthInputElement.val(),this.yearInputElement.val()]);let t=this.days.correctDate([this.day,this.month,this.year]);return this.day=t[0],this.month=t[1],this.year=t[2],this.days.checkCorrectDate(this.day,this.month,this.year)}clickToReady(){this.createDay(this.getIDSubjects())}getIDSubjects(){let t=[];for(let e=0;e<5;e++){let s=this.selectElements[e].selectedIndex;if(s===0){t.push(null);continue}t.push(m.lessons[s-1].id)}return t}clickToPrevSlide(){this.swiperElement.activeIndex===1&&(this.prevBtn.attr("disabled",!0),this.nextTextElement.text("Далее")),this.swiperElement.slidePrev(),this.counterElement.text(this.swiperElement.activeIndex+1),this.nameElement.text("Формирование даты")}clickToToday(){let t=new Date;this.dayInputElement.val(t.getDate()),this.monthInputElement.val(t.getMonth()+1),this.yearInputElement.val(t.getFullYear())}createSelects(){for(let t=0;t<5;t++){let e=['<option class="option" selected data-js-date-create-option>ничего</option>'];m.lessons.forEach(s=>{e.push(`
                <option class="option" data-js-date-create-option>${s.name}</option>
            `)}),$(this.selectElements[t]).html(e.join(""))}}}class it{constructor(){n(this,"selectors",{root:"[data-js-date-redact]",open:"[data-js-date-redact-open]",input:"[data-js-date-redact-input]",selectLoading:"[data-js-date-redact-select-loading]",select:"[data-js-date-redact-select]",close:"[data-js-date-redact-close]",redact:"[data-js-date-redact-btn]",btnLoading:"[data-js-date-redact-btn-loading]"});n(this,"classes",{isActive:"is-active"});n(this,"loadFunctions",()=>{$(document).on("createDaysList",()=>{this.openBtns=$(this.selectors.open),this.bindEvents()})});n(this,"redactDay",async t=>{try{y(this.redactBtn,this.btnLoadingElement);let e={user_id:p.activeUser.id,group_id:u.activeGroup.id,date_info:this.redactDayInfo.date_info,day:this.day,month:this.month,year:this.year,first_lesson:t[0],second_lesson:t[1],third_lesson:t[2],fourth_lesson:t[3],fifth_lesson:t[4]};(await z(e)).status===200?await this.redactClasses(e):await l("Что-то пошло не так..")}catch{await l("Что-то пошло не так..")}});n(this,"redactClasses",async t=>{var e;try{let s={user_id:t.user_id,group_id:t.group_id,date_info:this.redactDayInfo.date_info,new_date:`${t.day}${t.month}${t.year}`};if((await Z(s)).status===200){let c=-1,h=!1;if(i.activeDay.date_info===this.redactDayInfo.date_info){i.activeDay=t;let _=["first_lesson","second_lesson","third_lesson","fourth_lesson","fifth_lesson"];for(let g=0;g<5;g++)m.activeLessons[g]=(e=m.lessons.find(C=>C.id===t[_[g]]))==null?void 0:e.name;h=!0}i.daysList=i.daysList.map((_,g)=>_.date_info===t.date_info?(h&&(c=g),{...t}):_),$(document).trigger("redactDay",c),D("День изменен!!"),v(this.redactElement)}else await l("Что-то пошло не так..")}catch{await l("Что-то пошло не так..")}finally{y(this.redactBtn,this.btnLoadingElement)}});n(this,"clickToRedact",async()=>{await w("Вы действительно хотите редактировать день?")&&this.successToRedactDate()});n(this,"successToRedactDate",async()=>{if(this.correctDate()){let e=await this.days.getDate(0,1,[this.day,this.month,this.year]);if(!e.data.length||e.data[0].date_info===this.redactDayInfo.date_info){let s=this.getRedactLessons();this.redactDay(s)}else await l("Такая дата уже существует!!")}});n(this,"correctDate",async()=>{[this.day,this.month,this.year]=this.days.deleteUnnecessary([$(this.inputElements[0]).val(),$(this.inputElements[1]).val(),$(this.inputElements[2]).val()]);let t=this.days.correctDate([this.day,this.month,this.year]);return this.day=t[0],this.month=t[1],this.year=t[2],this.days.checkCorrectDate(this.day,this.month,this.year)?!0:(await l("Некорректная дата"),!1)});this.days=new i,this.redactElement=$(this.selectors.root),this.inputElements=this.redactElement.find(this.selectors.input),this.selectLoadingElements=this.redactElement.find(this.selectors.selectLoading),this.selectElements=this.redactElement.find(this.selectors.select),this.closeBtn=this.redactElement.find(this.selectors.close),this.redactBtn=this.redactElement.find(this.selectors.redact),this.btnLoadingElement=this.redactElement.find(this.selectors.btnLoading),this.redactDayInfo={},this.lessons=[],this.day="",this.month="",this.year="",this.loadFunctions()}bindEvents(){this.openBtns.off("click"),this.closeBtn.off("click"),this.redactBtn.off("click"),this.openBtns.each((t,e)=>{$(e).on("click",s=>{this.openBlock(e,t),this.getRedactDayLessons(),s.stopPropagation()})}),this.closeBtn.on("click",()=>{v(this.redactElement)}),this.redactBtn.on("click",this.clickToRedact.bind(this))}openBlock(t,e){this.redactDayInfo=i.daysList[e],j(this.redactElement,t),$(this.inputElements[0]).val(this.redactDayInfo.day),$(this.inputElements[1]).val(this.redactDayInfo.month),$(this.inputElements[2]).val(this.redactDayInfo.year)}getRedactDayLessons(){let t=[this.redactDayInfo.first_lesson,this.redactDayInfo.second_lesson,this.redactDayInfo.third_lesson,this.redactDayInfo.fourth_lesson,this.redactDayInfo.fifth_lesson];this.lessons=t.map(e=>{if(e===null)return null;const s=m.lessons.find(a=>(a==null?void 0:a.id)===e);return s?s==null?void 0:s.name:null}),this.createOptions()}createOptions(){for(let t=0;t<5;t++){let e=['<option class="option" selected>ничего</option>'];m.lessons.forEach(s=>{e.push(`
                    <option class="option">${s.name}</option>
                `)}),$(this.selectElements[t]).html(e.join(""))}this.setActiveLessons()}setActiveLessons(){let t=["first_lesson","second_lesson","third_lesson","fourth_lesson","fifth_lesson"];for(let e=0;e<5;e++)if(this.redactDayInfo[t[e]]!==null){let s;m.lessons.forEach((a,c)=>{a.id===this.redactDayInfo[t[e]]&&(s=c)}),this.selectElements[e].selectedIndex=s+1}this.removeSelectLoading()}removeSelectLoading(){this.selectLoadingElements.each((t,e)=>{$(e).removeClass(this.classes.isActive),this.closeBtn.attr("disabled",!1),this.redactBtn.attr("disabled",!1)})}getRedactLessons(){let t=[],e=[];return this.selectElements.each((s,a)=>{a.selectedIndex===0?e.push(null):e.push(a.selectedIndex-1)}),e.forEach(s=>{var a;t.push(((a=m.lessons[s])==null?void 0:a.id)??null)}),t}}A();new x;new M;new T;new u().getFromLocStore();new p().logInCheck();new X;new tt;new et;new st;new at;new nt;new it;
